<zk>
	<vlayout hflex="1" vflex="1">
	<zscript>
		import org.zkoss.zss.api.model.Sheet;
		import org.zkoss.image.AImage;
		import org.zkoss.zss.api.model.Picture.Format;
		import org.zkoss.zss.api.Ranges;
		import sun.misc.BASE64Decoder;
		
		public byte[] decodeToByte(String imageString) {

	        byte[] imageByte;
	        try {
	            BASE64Decoder decoder = new BASE64Decoder();
	            imageByte = decoder.decodeBuffer(imageString);
	        } catch (Exception e) {
	            e.printStackTrace();
	        }
	        return imageByte;
    	}
		public void export(Spreadsheet ss, String ext) {
			Exporter exporter = Exporters.getExporter();
			java.io.ByteArrayOutputStream os = new java.io.ByteArrayOutputStream();
			exporter.export(ss.getBook(), os);
			os.close();
			org.zkoss.zul.Filedownload.save(os.toByteArray(),
					"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet", "exported" + ext);
		}
		
	</zscript>
	<button id="inputPicture" label="Insert Picture">
		<attribute name="onClick">
			Sheet sheet = source.getSelectedSheet();
			String base64 = "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";
			SheetOperationUtil.addPicture(Ranges.range(sheet,3, 8), decodeToByte(base64),Format.PNG, 100, 100);
		</attribute>
	</button>
	1. press "insert picture" and export it. make sure the picture in exported file looks fine as well.
	xlsx <button label="export" onClick='export(source, ".xlsx");' /> 
	<spreadsheet id="source" src="/issue3/book/blank.xlsx" maxVisibleRows="100" maxVisibleColumns="40"
			hflex="1" vflex="1" showContextMenu="true" showSheetbar="true" showToolbar="true"
			ctrlKeys="^c^x^v^d^s^o^b^i^u#del^#del^z^y^e" />
	</vlayout>
</zk>